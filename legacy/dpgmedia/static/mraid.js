/iphone|ipad|ipod/i.test(window.navigator.userAgent.toLowerCase())&&(console={log:function(e){var t=document.createElement("iframe");t.setAttribute("src","ios-log: "+e),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null}},console.debug=console.info=console.warn=console.error=console.log),function(){var i=window.mraid={},a=window.mraidbridge={nativeSDKFiredReady:!1,nativeCallQueue:[],nativeCallInFlight:!1,lastSizeChangeProperties:null};a.fireChangeEvent=function(e){for(var t in e){if(e.hasOwnProperty(t))(0,w[t])(e[t])}},a.nativeCallComplete=function(e){if(0!==this.nativeCallQueue.length){var t=this.nativeCallQueue.pop();window.location=t}else this.nativeCallInFlight=!1},a.executeNativeCall=function(e){var t=e.shift();if(!this.nativeSDKFiredReady)return console.log("rejecting "+t+" because mraid is not ready"),void a.notifyErrorEvent("mraid is not ready",t);for(var n,r,i="mraid://"+t,s=!0,o=0;o<e.length;o+=2)n=e[o],null!==(r=e[o+1])&&(s?(i+="?",s=!1):i+="&",i+=encodeURIComponent(n)+"="+encodeURIComponent(r));this.nativeCallInFlight?this.nativeCallQueue.push(i):(this.nativeCallInFlight=!0,window.location=i)},a.setCurrentPosition=function(e,t,n,r){d={x:e,y:t,width:n,height:r},y(u.INFO,"Set current position to "+C(d))},a.setDefaultPosition=function(e,t,n,r){g={x:e,y:t,width:n,height:r},y(u.INFO,"Set default position to "+C(g))},a.setMaxSize=function(e,t){p={width:e,height:t},h.width=e,h.height=t,y(u.INFO,"Set max size to "+C(p))},a.setPlacementType=function(e){R=e,y(u.INFO,"Set placement type to "+C(R))},a.setScreenSize=function(e,t){v={width:e,height:t},y(u.INFO,"Set screen size to "+C(v))},a.setState=function(e){t=e,y(u.INFO,"Set state to "+C(t)),y(u.STATECHANGE,t)},a.setIsViewable=function(e){E=e,y(u.INFO,"Set isViewable to "+C(E)),y(u.VIEWABLECHANGE,E)},a.setSupports=function(e,t,n,r,i){f={sms:e,tel:t,calendar:n,storePicture:r,inlineVideo:i}},a.notifyReadyEvent=function(){this.nativeSDKFiredReady=!0,y(u.READY)},a.notifyErrorEvent=function(e,t){y(u.ERROR,e,t)},a.fireReadyEvent=a.notifyReadyEvent,a.fireErrorEvent=a.notifyErrorEvent,a.notifySizeChangeEvent=function(e,t){this.lastSizeChangeProperties&&e==this.lastSizeChangeProperties.width&&t==this.lastSizeChangeProperties.height||(this.lastSizeChangeProperties={width:e,height:t},y(u.SIZECHANGE,e,t))},a.notifyStateChangeEvent=function(){t===o.LOADING&&y(u.INFO,"Native SDK initialized."),y(u.INFO,"Set state to "+C(t)),y(u.STATECHANGE,t)},a.notifyViewableChangeEvent=function(){y(u.INFO,"Set isViewable to "+C(E)),y(u.VIEWABLECHANGE,E)};i.VERSION="2.0";function n(n){this.event=n,this.count=0;var r={};this.add=function(e){var t=String(e);r[t]||(r[t]=e,this.count++)},this.remove=function(e){var t=String(e);return!!r[t]&&(r[t]=null,delete r[t],this.count--,!0)},this.removeAll=function(){for(var e in r)r.hasOwnProperty(e)&&this.remove(r[e])},this.broadcast=function(e){for(var t in r)r.hasOwnProperty(t)&&r[t].apply(i,e)},this.toString=function(){var e=[n,":"];for(var t in r)r.hasOwnProperty(t)&&e.push("|",t,"|");return e.join("")}}function r(e,t){for(var n in t)if(t[n]===e)return!0;return!1}function s(e,t,n,r){if(!r){if(null===e)return y(u.ERROR,"Required object not provided.",n),!1;for(var i in t)if(t.hasOwnProperty(i)&&void 0===e[i])return y(u.ERROR,"Object is missing required property: "+i,n),!1}for(var s in e){var o=t[s],a=e[s];if(o&&!o(a))return y(u.ERROR,"Value of property "+s+" is invalid: "+a,n),!1}return!0}var o=i.STATES={LOADING:"loading",DEFAULT:"default",EXPANDED:"expanded",HIDDEN:"hidden",RESIZED:"resized"},u=i.EVENTS={ERROR:"error",INFO:"info",READY:"ready",STATECHANGE:"stateChange",VIEWABLECHANGE:"viewableChange",SIZECHANGE:"sizeChange"},e=i.PLACEMENT_TYPES={UNKNOWN:"unknown",INLINE:"inline",INTERSTITIAL:"interstitial"},h={width:!1,height:!1,useCustomClose:!1,isModal:!0},l={width:!1,height:!1,offsetX:!1,offsetY:!1,customClosePosition:"top-right",allowOffscreen:!0},c={allowOrientationChange:!0,forceOrientation:"none"},f={sms:!1,tel:!1,calendar:!1,storePicture:!1,inlineVideo:!1},p={},d={},g={},v={},m={},t=o.LOADING,E=!1,R=e.UNKNOWN,y=function(){for(var e=new Array(arguments.length),t=arguments.length,n=0;n<t;n++)e[n]=arguments[n];var r=e.shift();m[r]&&m[r].broadcast(e)},C=function(e){if("object"!=typeof e)return String(e);var t=[];if(e.push){for(var n in e)t.push(e[n]);return"["+t.join(",")+"]"}for(var n in e)t.push("'"+n+"': "+e[n]);return"{"+t.join(",")+"}"},w={state:function(e){t===o.LOADING&&y(u.INFO,"Native SDK initialized."),t=e,y(u.INFO,"Set state to "+C(e)),y(u.STATECHANGE,t)},viewable:function(e){E=e,y(u.INFO,"Set isViewable to "+C(e)),y(u.VIEWABLECHANGE,E)},placementType:function(e){y(u.INFO,"Set placementType to "+C(e)),R=e},sizeChange:function(e){for(var t in y(u.INFO,"Set screenSize to "+C(e)),e)e.hasOwnProperty(t)&&(v[t]=e[t])},supports:function(e){y(u.INFO,"Set supports to "+C(e)),f=e}},O={useCustomClose:function(e){return"boolean"==typeof e}};i.addEventListener=function(e,t){e&&t?r(e,u)?(m[e]||(m[e]=new n(e)),m[e].add(t)):y(u.ERROR,"Unknown MRAID event: "+e,"addEventListener"):y(u.ERROR,"Both event and listener are required.","addEventListener")},i.close=function(){t===o.HIDDEN?y(u.ERROR,"Ad cannot be closed when it is already hidden.","close"):a.executeNativeCall(["close"])},i.expand=function(e){if(this.getState()!==o.DEFAULT&&this.getState()!==o.RESIZED)y(u.ERROR,"Ad can only be expanded from the default or resized state.","expand");else{var t=["expand","shouldUseCustomClose",h.useCustomClose];e&&(t=t.concat(["url",e])),a.executeNativeCall(t)}},i.getExpandProperties=function(){return{width:h.width,height:h.height,useCustomClose:h.useCustomClose,isModal:h.isModal}},i.getCurrentPosition=function(){return{x:d.x,y:d.y,width:d.width,height:d.height}},i.getDefaultPosition=function(){return{x:g.x,y:g.y,width:g.width,height:g.height}},i.getMaxSize=function(){return{width:p.width,height:p.height}},i.getPlacementType=function(){return R},i.getScreenSize=function(){return{width:v.width,height:v.height}},i.getState=function(){return t},i.isViewable=function(){return E},i.getVersion=function(){return i.VERSION},i.open=function(e){e?a.executeNativeCall(["open","url",e]):y(u.ERROR,"URL is required.","open")},i.removeEventListener=function(e,t){if(e){if(t){var n=!1;if(m[e]&&(n=m[e].remove(t)),!n)return void y(u.ERROR,"Listener not currently registered for event.","removeEventListener")}else!t&&m[e]&&m[e].removeAll();m[e]&&0===m[e].count&&(m[e]=null,delete m[e])}else y(u.ERROR,"Event is required.","removeEventListener")},i.setExpandProperties=function(e){s(e,O,"setExpandProperties",!0)&&e.hasOwnProperty("useCustomClose")&&(h.useCustomClose=e.useCustomClose)},i.useCustomClose=function(e){h.useCustomClose=e,!0,a.executeNativeCall(["usecustomclose","shouldUseCustomClose",e])},i.createCalendarEvent=function(e){S.initialize(e),S.parse()?a.executeNativeCall(S.arguments):y(u.ERROR,S.errors[0],"createCalendarEvent")},i.supports=function(e){return f[e]},i.playVideo=function(e){i.isViewable()?e?a.executeNativeCall(["playVideo","uri",e]):y(u.ERROR,"playVideo must be called with a valid URI","playVideo"):y(u.ERROR,"playVideo cannot be called until the ad is viewable","playVideo")},i.storePicture=function(e){i.isViewable()?e?a.executeNativeCall(["storePicture","uri",e]):y(u.ERROR,"storePicture must be called with a valid URI","storePicture"):y(u.ERROR,"storePicture cannot be called until the ad is viewable","storePicture")};var N={width:function(e){return!isNaN(e)&&0<e},height:function(e){return!isNaN(e)&&0<e},offsetX:function(e){return!isNaN(e)},offsetY:function(e){return!isNaN(e)},customClosePosition:function(e){return"string"==typeof e&&-1<["top-right","bottom-right","top-left","bottom-left","center","top-center","bottom-center"].indexOf(e)},allowOffscreen:function(e){return"boolean"==typeof e}};i.setOrientationProperties=function(e){e.hasOwnProperty("allowOrientationChange")&&(c.allowOrientationChange=e.allowOrientationChange),e.hasOwnProperty("forceOrientation")&&(c.forceOrientation=e.forceOrientation);var t=["setOrientationProperties","allowOrientationChange",c.allowOrientationChange,"forceOrientation",c.forceOrientation];a.executeNativeCall(t)},i.getOrientationProperties=function(){return{allowOrientationChange:c.allowOrientationChange,forceOrientation:c.forceOrientation}},i.resize=function(){if(this.getState()!==o.DEFAULT&&this.getState()!==o.RESIZED)y(u.ERROR,"Ad can only be resized from the default or resized state.","resize");else if(l.width&&l.height){var e=["resize","width",l.width,"height",l.height,"offsetX",l.offsetX||0,"offsetY",l.offsetY||0,"customClosePosition",l.customClosePosition,"allowOffscreen",!!l.allowOffscreen];a.executeNativeCall(e)}else y(u.ERROR,"Must set resize properties before calling resize()","resize")},i.getResizeProperties=function(){return{width:l.width,height:l.height,offsetX:l.offsetX,offsetY:l.offsetY,customClosePosition:l.customClosePosition,allowOffscreen:l.allowOffscreen}},i.setResizeProperties=function(e){if(s(e,N,"setResizeProperties",!0))for(var t=["width","height","offsetX","offsetY","customClosePosition","allowOffscreen"],n=t.length,r=0;r<n;r++){var i=t[r];e.hasOwnProperty(i)&&(l[i]=e[i])}};var S={initialize:function(e){this.parameters=e,this.errors=[],this.arguments=["createCalendarEvent"]},parse:function(){this.parameters?(this.parseDescription(),this.parseLocation(),this.parseSummary(),this.parseStartAndEndDates(),this.parseReminder(),this.parseRecurrence(),this.parseTransparency()):this.errors.push("The object passed to createCalendarEvent cannot be null.");var e=this.errors.length;return e&&(this.arguments.length=0),0===e},parseDescription:function(){this._processStringValue("description")},parseLocation:function(){this._processStringValue("location")},parseSummary:function(){this._processStringValue("summary")},parseStartAndEndDates:function(){this._processDateValue("start"),this._processDateValue("end")},parseReminder:function(){var e=this._getParameter("reminder");e&&(e<0?(this.arguments.push("relativeReminder"),this.arguments.push(parseInt(e)/1e3)):(this.arguments.push("absoluteReminder"),this.arguments.push(e)))},parseRecurrence:function(){var e=this._getParameter("recurrence");e&&(this.parseRecurrenceInterval(e),this.parseRecurrenceFrequency(e),this.parseRecurrenceEndDate(e),this.parseRecurrenceArrayValue(e,"daysInWeek"),this.parseRecurrenceArrayValue(e,"daysInMonth"),this.parseRecurrenceArrayValue(e,"daysInYear"),this.parseRecurrenceArrayValue(e,"monthsInYear"))},parseTransparency:function(){if(this.parameters.hasOwnProperty("transparency")){var e=this.parameters.transparency;r(e,["opaque","transparent"])?(this.arguments.push("transparency"),this.arguments.push(e)):this.errors.push("transparency must be opaque or transparent")}},parseRecurrenceArrayValue:function(e,t){if(e.hasOwnProperty(t)){var n=e[t];if(n&&n instanceof Array){var r=n.join(",");this.arguments.push(t),this.arguments.push(r)}else this.errors.push(t+" must be an array.")}},parseRecurrenceInterval:function(e){if(e.hasOwnProperty("interval")){var t=e.interval;t?(this.arguments.push("interval"),this.arguments.push(t)):this.errors.push("Recurrence interval cannot be null.")}else this.arguments.push("interval"),this.arguments.push(1)},parseRecurrenceFrequency:function(e){if(e.hasOwnProperty("frequency")){var t=e.frequency;r(t,["daily","weekly","monthly","yearly"])?(this.arguments.push("frequency"),this.arguments.push(t)):this.errors.push('Recurrence frequency must be one of: "daily", "weekly", "monthly", "yearly".')}},parseRecurrenceEndDate:function(e){var t=e.expires;t&&(this.arguments.push("expires"),this.arguments.push(t))},_getParameter:function(e){return this.parameters.hasOwnProperty(e)?this.parameters[e]:null},_processStringValue:function(e){if(this.parameters.hasOwnProperty(e)){var t=this.parameters[e];this.arguments.push(e),this.arguments.push(t)}},_processDateValue:function(e){if(this.parameters.hasOwnProperty(e)){var t=this._getParameter(e);this.arguments.push(e),this.arguments.push(t)}}}}();