!function(){"use strict";function e(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class t{constructor(){this.startTime=0,this.intervalId=null}get isRunning(){return null!==this.intervalId}get elapsed(){return(performance.now()-this.startTime).toFixed(1)+"ms"}start(){this.startTime=performance.now()}stop(){null!==this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}}class n{constructor(e){this.logs=[],this.globalTimer=e}get all(){return this.logs}log({type:e,message:t,json:n}){const o=this.globalTimer.elapsed,i=(new Date).toLocaleString();this.logs.push({type:e,message:t,json:n,dateTime:`${i} (${o})`})}}const o="armp-console";class i{constructor(e){this.shownLogs=[],this.shownSlots=[],this.closeDiv=null,this.consoleDiv=null,this.contentDiv=null,this.iframe=null,this.navigationDiv=null,this.sliderDiv=null,this.isInitialized=!1,this.isOpen=!1,this.armp=e,this.helper=e.helper,this.setupConsole()}open(){var e,t;if(!this.isOpen&&(this.isInitialized||this.init(),null!==this.iframe)){this.isOpen=!0,this.iframe.style.display="block";const n=this.helper.getLocalStorageItem("consoleTab");if(null!==n){const t=null===(e=this.navigationDiv)||void 0===e?void 0:e.querySelector(`#${n}`);this.handleNavigationClick(t)}else this.handleNavigationClick(null===(t=this.navigationDiv)||void 0===t?void 0:t.firstElementChild);this.helper.setLocaltorageItem("consoleOpen",!0)}}close(){this.isOpen&&null!==this.iframe&&(this.isOpen=!1,this.resetContent(),this.iframe.style.display="none",this.helper.setLocaltorageItem("consoleOpen",!1))}createAdvertisement(e){const t=document.createElement("div");return t.classList.add("ad-container"),t.dataset.containerId=e.containerId,t.innerHTML=`\n        <strong>Container ID:</strong> ${e.containerId} <br>\n        <strong>Slot Type:</strong> ${e.slotType} <br>\n        <strong>Position:</strong> ${e.position} <br>\n        ${void 0!==e.devices?`<strong>Devices:</strong> ${e.devices.join(", ")} <br>`:""}\n    `,void 0!==e.data.slotPayload&&(t.innerHTML+=`\n        <strong>Slot Name:</strong> ${e.data.slotPayload.slotname} <br>\n        <strong>Parameters:</strong> ${JSON.stringify(e.data.slotPayload.parameters)} <br>\n      `),void 0!==e.data.adReceived&&(t.innerHTML+='<span class="ad-received">Ad Received</span>'),void 0!==e.data.adRendered&&(t.innerHTML+='<span class="ad-rendered">Ad Rendered</span>'),t}createInput(e,t){const n=document.createElement("input");return n.name=e,"boolean"==typeof t?(n.type="checkbox",n.checked=t):n.value=t.toString(),n}createInputFromValue(e,t){const n=!isNaN(Number(e)),o=document.createElement("div");if(o.classList.add("setting-wrapper"),!n){const t=document.createElement("label");t.classList.add("setting-label"),t.textContent=e,o.appendChild(t)}if("string"==typeof t){const n=document.createElement("input");n.name=e,n.classList.add("setting-input"),n.value=t,o.appendChild(n)}else if("boolean"==typeof t){const n=document.createElement("input");n.type="checkbox",n.name=e,n.checked=t,o.appendChild(n)}else if(Array.isArray(t)&&"devices"===e){const e=document.createElement("div");e.classList.add("devices-wrapper"),["desktop","phone","tablet"].forEach((n=>{const o=this.createToggleableDeviceChip(n,t);e.appendChild(o)})),o.appendChild(e)}else if(Array.isArray(t)){t.forEach(((t,n)=>{let i;i="slots"===e&&null!==t&&"object"==typeof t&&void 0!==t.containerId?t.containerId:null!==t&&"object"==typeof t&&""!==Object.keys(t)[0]?Object.keys(t)[0]:n.toString();const s=this.createInputFromValue(`${e} ${i}`,t);o.appendChild(s)}));const n=document.createElement("button");n.textContent="+",n.type="button",n.onclick=()=>{const i=this.createInputFromValue(`${e}[${t.length}]`,"");o.insertBefore(i,n),t.push("")},o.appendChild(n)}else if("object"==typeof t)if("collapse"===e){const e=this.createInput("onLoad",t.onLoad);o.appendChild(e);const n=this.createInput("onEmpty",t.onEmpty);o.appendChild(n)}else if("parameters"===e&&void 0!==t.any){const e=this.createInputFromValue("any",t.any);o.appendChild(e)}else for(const e in t){if("data"===e)continue;const n=this.createInputFromValue(e,t[e]);o.appendChild(n)}return o}createLog(e){const t=document.createElement("div");if(t.classList.add("log"),t.classList.add(e.type),t.textContent=e.dateTime+" "+e.message,void 0!==e.json){const n=document.createElement("span");n.classList.add("chevron"),n.innerHTML="▶",t.appendChild(n);const o=document.createElement("div");o.classList.add("json-container");const i=document.createElement("pre");i.textContent=JSON.stringify(e.json,null,2),o.appendChild(i),t.appendChild(o),n.addEventListener("click",(function(){t.classList.contains("expanded")?(t.classList.remove("expanded"),n.innerHTML="▶"):(t.classList.add("expanded"),n.innerHTML="▼")}))}return t}createToggleableDeviceChip(e,t){const n=document.createElement("div");return n.classList.add("device-chip"),n.textContent=e,t.includes(e)&&n.classList.add("active"),n.addEventListener("click",(()=>{if(t.includes(e)){const o=t.indexOf(e);o>-1&&(t.splice(o,1),n.classList.remove("active"))}else t.push(e),n.classList.add("active")})),n}handleNavigationClick(e){if(null==e||e.classList.contains("active"))console.error("Invalid navigation element, cannot handle click");else{switch(this.resetContent(),e.classList.add("active"),e.textContent){case"Advertisements":this.showAdvertisements();break;case"Logs":this.showLogs();break;case"Settings":this.showSettings()}this.helper.setLocaltorageItem("consoleTab",e.id)}}init(){this.setupCloseButton(),this.setupNavigation(),this.setupResizing(),this.isInitialized=!0}resetContent(){var e;if(clearInterval(this.interval),null===this.contentDiv)return;this.contentDiv.innerHTML="";const t=null===(e=this.navigationDiv)||void 0===e?void 0:e.querySelectorAll(".navigation__link");null==t||t.forEach((e=>{e.classList.remove("active")}))}setupCloseButton(){var e;null===(e=this.closeDiv)||void 0===e||e.addEventListener("click",(()=>{this.close()}))}setupConsole(){const e=document.querySelector(`#${o}`);null!==e&&e.remove();const t=document.createElement("iframe");t.id=o,t.style.width="100vw",t.style.minHeight="25vh",t.style.maxHeight="100vh",t.style.border="none",t.style.borderTop="1px solid #a1a1a1",t.style.position="fixed",t.style.bottom="0",t.style.right="0",t.style.left="0",t.style.display="none",t.style.zIndex="999999",t.style.boxSizing="border-box";const n=this.helper.getLocalStorageItem("consoleHeight");t.style.height=null!==n?n.toString()+"px":"40vh";const i=()=>{document.body.appendChild(t),this.iframe=t;const e=t.contentDocument;if(null===e)throw new Error("Cannot access iframe contentDocument");const n=e.createElement("style");n.innerHTML=":root {\n  --dark-grey: #a1a1a1;\n  --light-grey: #ebebeb;\n  --white: #fff;\n  --black: #000;\n  --blue: rgb(0, 166, 255);\n  --blue-hover: rgb(0, 150, 230);\n  --red: #ff0000;\n  --yellow: #ffcc00;\n  --green: #00cc00;\n}\n\n*,\n*::before,\n*::after {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 14px;\n  line-height: 1.5;\n}\n\n.console {\n  width: 100vw;\n  height: 100vh;\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  display: flex;\n  flex-direction: column;\n  color: var(--black);\n  border-top: 1px solid var(--dark-grey);\n  z-index: 99999;\n}\n\n.console.hidden {\n  display: none;\n}\n\n.top,\n.navigation,\n.options {\n  display: flex;\n  align-items: center;\n  height: 48px;\n}\n\n.top {\n  background-color: var(--light-grey);\n  justify-content: space-between;\n  padding: 0 25px;\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n  z-index: 1;\n}\n\n.navigation {\n  gap: 10px;\n  justify-content: flex-start;\n  flex: 1;\n}\n\n.options {\n  justify-content: flex-end;\n  flex: 1;\n}\n\n.navigation__link {\n  padding: 15px 10px;\n  height: 100%;\n  transition:\n    border-color 0.1s,\n    color 0.1s;\n  color: var(--dark-grey);\n  border-bottom: 2px solid transparent;\n  user-select: none;\n  cursor: pointer;\n}\n\n.navigation__link:hover {\n  color: var(--black);\n}\n.navigation__link.active,\n.navigation__link.active:hover {\n  color: var(--blue);\n  border-color: var(--blue);\n}\n\n.slider,\n.settings,\n.close {\n  height: 25px;\n  width: 25px;\n}\n\n.slider {\n  cursor: ns-resize;\n}\n.close:hover {\n  cursor: pointer;\n}\n\n.bottom {\n  height: 100%;\n  padding: 25px;\n  background-color: var(--white);\n  overflow-y: scroll;\n}\n\n.log,\n.ad-container {\n  padding: 10px;\n  border-radius: 5px;\n  border: 1px solid var(--light-grey);\n}\n\n.log {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n  border-left: 2px solid var(--blue);\n  margin-bottom: 10px;\n}\n\n.log .json-container {\n  display: none;\n  margin-top: 5px;\n  padding: 10px;\n  background-color: var(--light-grey);\n}\n\n.json-container pre {\n  white-space: pre-wrap;\n}\n\n.log .chevron {\n  cursor: pointer;\n  margin-left: 10px;\n}\n\n.log.expanded .json-container {\n  display: block;\n}\n.log.error {\n  border-color: var(--red);\n}\n.log.warn {\n  border-color: var(--yellow);\n}\n\n.ad-container {\n  margin-bottom: 10px;\n  gap: 5px;\n}\n\n.ad-container strong {\n  color: var(--black);\n  font-weight: bold;\n}\n\n.ad-received,\n.ad-rendered {\n  padding: 5px 10px;\n  margin-right: 5px;\n  margin-top: 5px;\n  display: inline-block;\n  border-radius: 3px;\n}\n\n.ad-received {\n  background-color: var(--yellow);\n  color: var(--black);\n}\n.ad-rendered {\n  background-color: var(--green);\n  color: var(--white);\n}\n\n.settings-form {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.settings-fieldset,\n.settings-fieldset > .setting-wrapper {\n  border: 1px solid var(--light-grey);\n}\n\n.settings-fieldset,\n.setting-wrapper {\n  margin: 10px 10px;\n  border-radius: 5px;\n  position: relative;\n}\n\n.settings-legend,\n.setting-label {\n  padding: 5px;\n  font-weight: bold;\n  color: var(--black);\n}\n\n.setting-input {\n  display: block;\n  width: 100%;\n  padding: 5px;\n  border: 1px solid var(--light-grey);\n  border-radius: 3px;\n  background-color: var(--light-grey);\n}\n\n.device-chip {\n  display: inline-block;\n  padding: 5px 10px;\n  margin: 2px;\n  border-radius: 15px;\n  background-color: var(--light-grey);\n  cursor: pointer;\n  transition: background-color 0.3s;\n}\n\n.device-chip.active {\n  background-color: var(--green);\n  color: var(--white);\n}\n\nbutton {\n  padding: 5px 10px;\n  border: none;\n  border-radius: 3px;\n  cursor: pointer;\n  background-color: var(--blue);\n  color: var(--white);\n  transition: background-color 0.3s;\n}\n\nbutton:hover {\n  background-color: var(--blue-hover);\n}\n\nbutton[type='submit'] {\n  margin: 20px auto 0;\n}\n",e.head.appendChild(n);const o=e.createElement("div");if(o.innerHTML='<div class="top">\n  <div class="navigation"></div>\n  <div class="slider">\n    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">\n      <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5"/>\n    </svg>\n  </div>\n  <div class="options">\n    <div class="close">\n      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">\n        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>\n      </svg>\n    </div>\n  </div>\n</div>\n<div class="bottom"></div>\n',o.classList.value="console",e.body.appendChild(o),this.closeDiv=e.querySelector(".close"),this.consoleDiv=e.querySelector(".console"),this.contentDiv=e.querySelector(".bottom"),this.navigationDiv=e.querySelector(".navigation"),this.sliderDiv=e.querySelector(".slider"),null===this.closeDiv||null===this.consoleDiv||null===this.contentDiv||null===this.navigationDiv||null===this.sliderDiv)throw new Error("Failed to query some elements inside the iframe");this.open()};if("loading"===document.readyState||null===document.body)document.addEventListener("DOMContentLoaded",i);else{if("interactive"!==document.readyState&&"complete"!==document.readyState)throw new Error("Cannot insert console into iframe");i()}}setupNavigation(){["Advertisements","Logs","Settings"].forEach((e=>{var t;const n=document.createElement("div");n.classList.add("navigation__link"),n.textContent=e,n.id=e.toLowerCase(),null===(t=this.navigationDiv)||void 0===t||t.appendChild(n),n.addEventListener("click",(()=>{this.handleNavigationClick(n)}))}))}setupResizing(){let e=!1,t=null,n=null;if(null===this.sliderDiv)return;this.sliderDiv.addEventListener("mousedown",(i=>{null!==this.iframe&&(e=!0,t=i.clientY+this.iframe.getBoundingClientRect().top,n=this.iframe.offsetHeight,o(),i.preventDefault())}));const o=()=>{const o=document.createElement("div");o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="100vw",o.style.height="100vh",o.style.zIndex="999999",o.style.cursor="ns-resize",o.addEventListener("mousemove",(o=>{if(!e||null===t||null===this.iframe||null===n)return;const i=o.clientY-t,s=n-i;this.iframe.style.height=`${s}px`,this.helper.setLocaltorageItem("consoleHeight",s.toString())})),o.addEventListener("mouseup",(()=>{e=!1,t=null,document.body.removeChild(o)})),document.body.appendChild(o)}}showAdvertisements(){const e=this.armp.slots;e.forEach((e=>{var t;this.shownSlots.push(e);const n=this.createAdvertisement(e);null===(t=this.contentDiv)||void 0===t||t.appendChild(n)})),this.interval=setInterval((()=>{this.shownSlots!==e&&e.forEach((e=>{var t,n,o;null===(n=null===(t=this.contentDiv)||void 0===t?void 0:t.querySelector(`div[data-container-id="${e.containerId}"]`))||void 0===n||n.remove();const i=this.createAdvertisement(e);this.shownSlots.push(e),null===(o=this.contentDiv)||void 0===o||o.appendChild(i)}))}),500)}showLogs(){var e;const t=this.armp.logger.all,n=document.createElement("div");n.classList.add("logs"),t.forEach((e=>{this.shownLogs.push(e);const t=this.createLog(e);n.appendChild(t)})),null===(e=this.contentDiv)||void 0===e||e.appendChild(n),this.interval=setInterval((()=>{if(this.shownLogs.length!==t.length)for(let e=this.shownLogs.length;e<t.length;e++){const o=t[e];this.shownLogs.push(o);const i=this.createLog(o);n.appendChild(i)}}),50)}showSettings(){var e;const t=document.createElement("form");t.classList.add("settings-form");const n={slots:this.armp.slots,data:this.armp.data,options:this.armp.options};for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const o=n[e],i=document.createElement("fieldset");i.classList.add("settings-fieldset");const s=document.createElement("legend");s.classList.add("settings-legend"),s.textContent=e[0].toUpperCase()+e.slice(1),i.appendChild(s);for(const e in o)if(Object.prototype.hasOwnProperty.call(o,e)){const t=o[e],n=this.createInputFromValue(e,t);i.appendChild(n)}t.appendChild(i)}const o=document.createElement("button");o.type="submit",o.textContent="Save Settings",o.classList.add("settings-submit"),t.appendChild(o),null===(e=this.contentDiv)||void 0===e||e.appendChild(t)}}class s{constructor(e){this.armp=e,this.logger=e.logger}fireBrowserEvent(e,t){const n=this.armp.sdkName.toLowerCase(),o=new CustomEvent(`${n}:`+e,null!==t?{detail:t}:void 0);window.dispatchEvent(o),this.logger.log({type:"log",message:`Fired browser event ${n}:${e}`})}firePixelTracker(e){const t=new Image;t.src=e,this.logger.log({type:"log",message:`Fired pixel tracker ${e}`}),document.body.appendChild(t)}getDeviceType(){const e=window.innerWidth;return e<768?"phone":e<1024?"tablet":"desktop"}mergeData(e){return e.reduce(((e,t)=>e.concat(t)),[])}setLocaltorageItem(e,t){localStorage.setItem("armp:"+e,t.toString())}getLocalStorageItem(e){var t;const n=null!==(t=localStorage.getItem("armp:"+e))&&void 0!==t?t:null;return"true"===n||"false"!==n&&n}removeLocalStorageItem(e){localStorage.removeItem("armp:"+e)}getQueryStringParameter(e){const t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}async fetchHelper(e,t){return this.logger.log({type:"log",message:`Fetching ads from adserver at ${e}`,json:t}),this.fireBrowserEvent("adheseAdsRequested",t),await fetch(e,{method:"POST",credentials:"same-origin",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify(t)}).then((async e=>{const t=await e.json();return this.logger.log({type:"log",message:`Received: ${t.length} ads from Adhese adserver`,json:t}),this.fireBrowserEvent("adheseAdsReceived",t),t})).catch((e=>(this.logger.log({type:"error",message:`Error fetching ads from Adhese adserver: ${e}`}),null)))}}const r=["adhesePreviewCreativeId","adhesePreviewSlotId","adhesePreviewCreativeTemplate","adhesePreviewWidth","adhesePreviewHeight","adhesePreviewTemplateFile","adhesePreviewCreativeKey"];class a{constructor(e){this.previewSign=null,this.previewFormat=null,this.previewActive=!1,this.armp=e,this.logger=e.logger,this.helper=e.helper,this.closePreviewSign=this.closePreviewSign.bind(this),this.init()}init(){const e=this.helper.getLocalStorageItem("previewer"),t=window.location.search.substring(1);t.includes("adhesePreview")?this.setupPreviewFromURL(t):null!==e&&"boolean"!=typeof e?this.setupPreviewFromLocalStorage(e):this.logger.log({type:"log",message:"No preview data found in URL or localstorage, preview mode not active"}),this.previewActive&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",this.showPreviewSign):this.showPreviewSign())}setupPreviewFromURL(e){const t=e.split("&");let n="";const o=[];for(let e=0;e<t.length;e++){const[i,s]=t[e].split("=");switch(i){case"adhesePreviewCreativeId":n=decodeURIComponent(s);break;case"adhesePreviewCreativeTemplate":o.push(s)}}this.previewFormat={creativeId:n,formats:o},this.logger.log({type:"log",message:"Preview mode found in URL parameters",json:this.previewFormat});const i=[];i.push(`${n},${o.join(",")}`),this.helper.setLocaltorageItem("previewer",i.join("|")),this.previewActive=!0}setupPreviewFromLocalStorage(e){this.logger.log({type:"log",message:"Preview mode found in local storage",json:e}),e.split("|").forEach((e=>{const[t,n]=e.split(",");this.previewFormat={creativeId:t,formats:n.split(",")}})),this.previewActive=!0}showPreviewSign(){const e=document.createElement("div");e.style.cssText="cursor:pointer;font-family:Helvetica,Verdana; font-size:12px; text-align:center; background-color: rgba(0,0,0,0.5); color: #FFFFFF; position:fixed; top:10px;left:10px;padding:10px;z-index:9999;width: 100px;",e.innerHTML="PREVIEW MODE<br/>click to close",e.addEventListener("click",this.closePreviewSign),this.previewSign=e,document.body.appendChild(e)}closePreviewSign(){const e=new URL(window.location.href),t=new URLSearchParams(e.search);r.forEach((e=>{t.delete(e)})),e.search=t.toString(),this.helper.removeLocalStorageItem("previewer"),window.history.replaceState({},"",e.toString()),window.location.reload()}}let l=class{constructor(e,o,i){var r,a;this.globalTimer=new t,this.logger=new n(this.globalTimer),this.helper=new s(this),this.slots=[],null!==(r=null==e?void 0:e.options.debug)&&void 0!==r&&r&&this.globalTimer.start();const l=this.validateConfig(e);this.account=null!=o?o:"demo",this.sdkName=null!=i?i:"Armp",this.data=l.data,this.slots=null!==(a=l.slots)&&void 0!==a?a:[],this.options=l.options,this.init(),"true"===localStorage.getItem("armp:consoleOpen")&&this.openConsole()}collapseEmptyDiv(e){const t=document.getElementById(e);null!==t&&""===t.innerHTML&&t.remove()}convertParameters(e,t,n){const o=Object.keys(e).reduce(((o,i)=>{var s,r;const a=t[i];if(void 0!==a&&""!==a){let t=e[i];"boolean"==typeof t&&(t=null!==(r=null===(s=n[i])||void 0===s?void 0:s[t.toString()])&&void 0!==r?r:t.toString());const l=(Array.isArray(t)?t:[t]).flatMap((e=>{var t;if("string"==typeof e){let o=e.trim().toLowerCase().replace(/\s+/g,"_");const s=null===(t=n[i])||void 0===t?void 0:t[o];return void 0!==s&&(o=s),o.includes("/")?o.split("/").map((e=>e.replace(/-/g,"_"))):o.replace(/-/g,"_")}return e}));if(void 0!==o[a]&&null!==o[a]){const e=o[a];o[a]=[...e,...l]}else o[a]=l}return o}),{});for(const e in o){const t=o[e];Array.isArray(t)&&(o[e]=t.flatMap((e=>Array.isArray(e)?e:[e])))}return o}openConsole(){if("loading"===document.readyState||null===document.body)document.addEventListener("DOMContentLoaded",(()=>{void 0!==this.console||(this.console=new i(this)),this.console.open()}));else{if("interactive"!==document.readyState&&"complete"!==document.readyState)throw new Error("Cannot insert console into iframe");void 0!==this.console||(this.console=new i(this)),this.console.open()}}async fetchPreviewAds(e){const t=`https://${this.account}-preview.adhese.org/creatives/preview/json/tag.do?id=${e.creativeId}`,n=await this.helper.fetchHelper(t);if(n.length>0){const t=new Set(e.formats),o=new Set(this.slots.filter((e=>{var t;return"string"==typeof(null===(t=e.data.slotPayload)||void 0===t?void 0:t.slotname)})).map((e=>{var t;return null===(t=e.data.slotPayload)||void 0===t?void 0:t.slotname}))),i=n.find((t=>t.id===e.creativeId));if(void 0!==i){const e=[];for(const n of t)for(const t of o)if(t.includes(n)){const n={...i,slotName:t};e.push(n),o.delete(t);break}n.length=0,n.push(...e)}}return this.logger.log({type:"log",message:`Created ${n.length} ads using preview format`,json:n}),n}async fetchAdheseAds(e,t){if(console.log("fetchAdheseAds",e,t),void 0!==this.preview&&this.preview.previewActive){const e=this.preview.previewFormat;return null===e?(this.logger.log({type:"error",message:"Preview is enabled but preview format is not available, cannot fetch ads"}),[]):(this.logger.log({type:"log",message:"Preview is enabled"}),await this.fetchPreviewAds(e))}return await this.helper.fetchHelper(e,t)}renderAsHtml(e){const t=document.getElementById(e.slotName);null!=t?(""!==t.innerHTML&&(this.logger.log({type:"log",message:`Container for slot ${e.slotName} is not empty, emptying...`}),t.innerHTML=""),t.style.display="block",this.insertHTMLWithScripts(t,e.tag),this.logger.log({type:"log",message:`Rendered ad as HTML for slot ${e.slotName}`}),this.helper.fireBrowserEvent("adheseAdRendered",e),this.helper.firePixelTracker(e.trackedImpressionCounter)):this.logger.log({type:"error",message:`No container found for slot ${e.slotName}`})}renderAsIframe(e){var t;const n=document.getElementById(e.slotName);if(null===n)return void this.logger.log({type:"error",message:`No container found for slot ${e.slotName}`});""!==n.innerHTML&&(this.logger.log({type:"log",message:`Container for slot ${e.slotName} is not empty, emptying...`}),n.innerHTML=""),n.style.marginBottom="0px",n.style.display="block",n.style.width=void 0!==e.width?`${e.width}px`:"100%",n.style.height=void 0!==e.height?`${e.height}px`:"100%";const o=document.createElement("iframe");o.width="100%",o.height="100%",o.style.width="100%",o.style.height="100%",o.frameBorder="0",o.scrolling="no",o.style.margin="0 auto",o.style.display="block",n.appendChild(o);let i=""!==e.body?e.body:e.tag;const s=null===(t=o.contentWindow)||void 0===t?void 0:t.document;void 0!==s?(i+="<style>body{margin:0px;}</style>",s.write(i),s.close()):this.logger.log({type:"error",message:`No contentWindow found for iframe in slot ${e.slotName}`}),this.logger.log({type:"log",message:`Rendered ad as iframe for slot ${e.slotName}`}),this.helper.fireBrowserEvent("adheseAdRendered",e),this.helper.firePixelTracker(e.trackedImpressionCounter)}setContainerHeight(e){if(void 0===e)return void this.logger.log({type:"error",message:"Slot is undefined, cannot set container height"});void 0===e.data.retryCount&&(e.data.retryCount=1);const t=document.getElementById(e.containerId);if(null!=t){const n=t.parentNode;window.getComputedStyle(n).display.includes("none")&&n.style.setProperty("display","block","important");const o=e=>null!==e.style.height&&parseInt(e.style.height)>100,i=e=>null!==e.style.height&&parseInt(e.style.height)<100;if(o(n))return void this.logger.log({type:"log",message:`Container height properly set for slot ${e.containerId}: ${n.style.height}, not resizing...`});i(n)&&this.logger.log({type:"log",message:`Container for slot ${e.containerId} is < 100px, resizing...`}),"phone"===this.helper.getDeviceType()?(n.style.minHeight="100px",this.logger.log({type:"log",message:`Setting container min-height to 100px for slot ${e.containerId}`})):(n.style.minHeight="200px",this.logger.log({type:"log",message:`Setting container min-height to 200px for slot ${e.containerId}`}))}else e.data.retryCount<5&&setTimeout((()=>{void 0!==e.data.retryCount?e.data.retryCount++:e.data.retryCount=1,this.setContainerHeight(e)}),100)}init(){if("undefined"==typeof Storage){const e=localStorage.getItem("debugConfig");null!==e&&this.validateConfig(JSON.parse(e))}this.logger.log({type:"log",message:`Initializing ${this.sdkName}...`}),this.helper.fireBrowserEvent("init"),this.options.disableAds&&this.logger.log({type:"log",message:"Ads are disabled, not fetching any ads"}),this.preview=new a(this)}insertHTMLWithScripts(e,t){const n=(new DOMParser).parseFromString(t,"text/html");for(;null!==n.body.firstChild;){const t=n.body.firstChild;if("SCRIPT"!==t.tagName)e.appendChild(t);else{const e=document.createElement("script");""!==t.src?e.src=t.src:e.textContent=t.textContent;for(const n of t.attributes)e.setAttribute(n.name,n.value);document.body.appendChild(e),document.body.removeChild(e),n.body.removeChild(t)}}}validateConfig(e){var t,n,o,i,s,r,a,l;if(null==e)throw new Error("Config is undefined");const d={data:e.data,options:e.options,slots:null===(t=e.slots)||void 0===t?void 0:t.map((e=>({...e,data:{}})))};if(void 0===(null==d?void 0:d.data)||void 0===d.options)throw new Error("Could not initialize SDK, config misses either data or options");if(d.options={debug:null!==(o=null===(n=d.options)||void 0===n?void 0:n.debug)&&void 0!==o&&o,disableAds:null!==(s=null===(i=d.options)||void 0===i?void 0:i.disableAds)&&void 0!==s&&s,adDisclaimer:null!==(a=null===(r=d.options)||void 0===r?void 0:r.adDisclaimer)&&void 0!==a?a:""},d.options.disableAds&&this.logger.log({type:"log",message:"Ads are disabled, not fetching any ads"}),0===(null===(l=d.slots)||void 0===l?void 0:l.length)&&this.logger.log({type:"log",message:"No slots provided. Is this intentional?"}),void 0!==d.slots&&d.slots.length>0){const e=d.slots.map((e=>e.slotType)),t=[...new Set(e)];e.length!==t.length&&d.slots.forEach(((t,n)=>{e.indexOf(t.slotType)!==n&&(t.data.enumerator=n.toString())})),d.slots.forEach((e=>{void 0!==e.slotType&&void 0!==e.containerId?void 0===e.devices&&(e.devices=["desktop","tablet","phone"]):this.logger.log({type:"error",message:"No slotType or containerId provided in slot"})}))}if(void 0===d.data.domain)throw new Error(`[${this.sdkName}]: No domain provided in data`);if(void 0===d.data.pageType)throw new Error(`[${this.sdkName}]: No pageType provided in data`);return d.data={...d.data,consent:d.data.consent||!1},d}};class d extends l{constructor(t,n,o){super(t,n,o),this.determineRenderMethod=e=>(console.log(e.ext),"1"===e.width&&"1"===e.height?e.renderMethod="html":("js"===e.ext||this.logger.log({type:"warn",message:`Could not determine render method for ad with slot name ${e.slotName}, setting iframe as default`}),e.renderMethod="iframe"),this.logger.log({type:"log",message:`Rendermethod for ${e.slotName} is ${e.renderMethod}`}),e),this.fetchAndRenderAds=t=>e(this,void 0,void 0,(function*(){Array.isArray(t)||(t=[t]),t.forEach((e=>{void 0===this.slots.find((t=>t.containerId===e.containerId))&&this.slots.push(e)}));const e=t.filter((e=>void 0!==e.devices&&e.devices.includes(this.helper.getDeviceType()))),n=this.getRequestPayload(e),o=`https://content1.${this.data.domain}/json`,i=yield this.fetchAdheseAds(o,n);this.renderAds(i)})),this.getRequestPayload=e=>{const t={position:"ps",consent:"tl",pageType:"pt",category:"ct",subCategory:"ct",productGroup:"ct",searchTerm:"kw",userId:"mi",userMode:"um",inOrderMode:"om",customerType:"cu"},n={consent:{true:"all",false:"none"}},o={rectangle:{desktop:"336x280",tablet:"336x280",phone:"320x240"},footer:{desktop:"970x250",tablet:"728x90",phone:"320x240"},header:{desktop:"970x250",tablet:"728x90",phone:"320x240"},home:{desktop:"native",tablet:"native",phone:"native"},sidebar:{desktop:"300x600",tablet:"120x600",phone:""},native:{desktop:"native",tablet:"native",phone:"native"}},i={};this.slots.forEach((e=>{const t=e.slotType+"_"+e.position;void 0!==e.data.slotPayload&&null!==e.data.slotPayload.slotname&&(t in i||(i[t]=0),i[t]++)}));const s=(e=Array.isArray(e)?e:[e]).map((e=>{void 0===e.data.slotPayload&&(e.data.slotPayload={});const s=this.data.domain,r=e.slotType+"_"+e.position;let a;void 0===i[r]&&(i[r]=0),i[r]++;const l=i[r],d=this.helper.getDeviceType(),c=e.slotType,h=o[c][d];e.data.slotPayload.format=c,a=l>1?`${s}_${this.data.pageType}_${c}_${l}_${e.position}-${h}`:`${s}_${this.data.pageType}_${c}_${e.position}-${h}`,e.data.slotPayload.slotname=a;const p=this.convertParameters(e,t,n);return e.data.slotPayload.parameters=p,{slotname:a,parameters:p}}));return{slots:s,parameters:this.convertParameters(this.data,t,n)}},this.refresh=()=>{c=new d(ArmpConfig)},this.renderAds=e=>{e.forEach((e=>{e=this.determineRenderMethod(e);const t=this.slots.find((t=>{var n;return(null===(n=t.data.slotPayload)||void 0===n?void 0:n.slotname)===e.slotName}));if(void 0===t)return void this.logger.log({type:"warn",message:`Could not find slot for ad ${e.slotName}, skipping render`});let n;t.data.adReceived=!0;const o=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(r(),o.disconnect())}))}),{root:null,rootMargin:"200px 0px",threshold:.1}),i=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&t.intersectionRatio>=.5?n=setTimeout((()=>{i.disconnect(),this.logger.log({type:"log",message:`Tracking viewable impression for slot ${e.slotName}`}),this.helper.firePixelTracker(e.viewableImpressionCounter)}),1e3):clearTimeout(n)}))}),{threshold:.5}),s=e=>{const t=document.querySelector(`#${e}`);if(null!==t)try{o.observe(t),i.observe(t),this.logger.log({type:"log",message:`Start observing container '${e}' for intersection`})}catch(t){this.logger.log({type:"error",message:`Error occurred while observing container '${e}' for intersection`,json:t})}else this.logger.log({type:"warn",message:`Could not find container for slot ${e}, skipping intersection observer`})},r=()=>{const n=document.querySelector(`#${t.containerId}`);if(n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.justifyContent="center",n.style.height="100%",n.style.margin="5px 0",void 0!==this.options.adDisclaimer&&""!==this.options.adDisclaimer){const e=document.createElement("div");e.innerHTML=this.options.adDisclaimer,e.style.fontSize="10px",e.style.color="#999",n.appendChild(e)}const o=document.createElement("div");switch(o.id=e.slotName,o.style.height="100%",o.style.display="block",n.appendChild(o),e.renderMethod){case"iframe":this.renderAsIframe(e);break;case"html":this.renderAsHtml(e);break;default:this.logger.log({type:"log",message:`Could not determine render method for ad with slot name ${e.slotName}, setting safeframe as default`})}t.data.adRendered=!0};if(null===document.querySelector("#"+t.containerId)){this.logger.log({type:"warn",message:`Could not find container for slot ${t.containerId}, creating mutation observer to check if it is added later`});const e=new MutationObserver((n=>{for(const o of n)if("childList"===o.type){null!==document.querySelector("#"+t.containerId)&&(this.logger.log({type:"log",message:`${t.containerId} is added to the DOM`}),e.disconnect(),s(t.containerId))}})),n={childList:!0,subtree:!0};e.observe(document,n)}else s(t.containerId)}))},this.fetchAndRenderAds(this.slots)}}let c=new d(ArmpConfig,"gamemania");window.armp=c}();
